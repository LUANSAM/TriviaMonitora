<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Trivia Monitora{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body data-auth="{% if session.get('user') %}1{% else %}0{% endif %}">
    <div class="app-shell">
        <header class="app-header">
            <button class="menu-toggle" type="button" data-sidenav-toggle aria-label="Abrir menu" aria-controls="appSidenav" aria-expanded="false">
                <span class="menu-toggle-bar"></span>
                <span class="menu-toggle-bar"></span>
                <span class="menu-toggle-bar"></span>
            </button>
            <a class="header-link" href="{{ url_for('home') }}">
                <div class="header-brand">
                    <h1>Trivia Monitora</h1>
                </div>
                <div class="header-logo">
                    <img src="{{ url_for('serve_public_asset', filename='logo.png') }}" alt="Logo Trivia" loading="lazy">
                </div>
            </a>
        </header>

        <div class="sidenav-overlay" data-sidenav-overlay></div>
        <aside id="appSidenav" class="sidenav" aria-hidden="true">
            <div class="sidenav-header">
                <div class="sidenav-brand">
                    <img src="{{ url_for('serve_public_asset', filename='logo.png') }}" alt="Logo Trivia" loading="lazy">
                </div>
                <div class="sidenav-auth-row">
                    {% if session.get('user') %}
                    <a class="sidenav-auth-action sidenav-auth-action--logout" href="{{ url_for('logout') }}">
                        <span>Sair</span>
                        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </a>
                    {% else %}
                    <a class="sidenav-auth-action sidenav-auth-action--login" href="{{ url_for('login') }}">
                        <span>Entrar</span>
                        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M15 3h4a2 2 0 0 1 2 2v4"></path>
                            <polyline points="10 17 15 12 10 7"></polyline>
                            <line x1="15" y1="12" x2="3" y2="12"></line>
                        </svg>
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="sidenav-content">
                {% if session.get('user') %}
                <nav class="app-nav" aria-label="Navegação principal">
                    <div class="nav-row">
                        <a class="nav-link" href="{{ url_for('home') }}">
                            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg>
                            <span class="nav-text">Níveis</span>
                        </a>
                        <button class="nav-link nav-link--square nav-link--print no-print" type="button" id="print-fuel-btn" aria-label="Imprimir níveis de combustível">
                            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 9V2h12v7" />
                                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" />
                                <path d="M6 14h12v8H6z" />
                            </svg>
                        </button>
                    </div>
                    <button class="nav-link" type="button" data-menu-action="soon">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                        <span class="nav-text">Equipamentos</span>
                    </button>
                    <button class="nav-link" type="button" data-menu-action="soon">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <span class="nav-text">Operação</span>
                    </button>
                    {% if session.get('user') and session.get('user').get('role') != 'Usuário' %}
                    <button class="nav-link" type="button" data-menu-action="soon">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="3" x2="9" y2="21"/>
                        </svg>
                        <span class="nav-text">Consumíveis</span>
                    </button>
                    {% endif %}
                    <button class="nav-link" type="button" data-menu-action="soon">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="4" y1="9" x2="20" y2="9"/>
                            <line x1="4" y1="15" x2="20" y2="15"/>
                            <line x1="10" y1="3" x2="8" y2="21"/>
                            <line x1="16" y1="3" x2="14" y2="21"/>
                        </svg>
                        <span class="nav-text">Números</span>
                    </button>
                    <button class="nav-link" type="button" data-menu-action="soon">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                        </svg>
                        <span class="nav-text">Lista telefônica</span>
                    </button>
                    <button class="nav-link" type="button" data-menu-action="soon">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        <span class="nav-text">Endereços</span>
                    </button>
                    {% if session.get('user') and session.get('user').get('role') == 'superAdm' %}
                    <button class="nav-link" type="button" data-menu-action="soon">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        <span class="nav-text">Logs de acesso</span>
                    </button>
                    {% endif %}
                </nav>
                {% endif %}
            </div>
        </aside>

        

        <main class="app-main">
            {% block content %}{% endblock %}
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
    <div class="toast-stack" data-toast-stack></div>
    <script>
        // Sistema de limpeza de dados ao fazer logout
        document.addEventListener('DOMContentLoaded', function() {
            // Encontrar todos os links de logout
            const logoutLinks = document.querySelectorAll('a[href="{{ url_for("logout") }}"]');
            
            logoutLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Limpar todos os dados armazenados localmente
                    console.log('Limpando dados temporários...');
                    
                    // Limpar localStorage
                    localStorage.clear();
                    
                    // Limpar sessionStorage
                    sessionStorage.clear();
                    
                    // Limpar cookies de sessão (se houver)
                    document.cookie.split(";").forEach(function(c) {
                        document.cookie = c
                            .replace(/^ +/, "")
                            .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                    });
                    
                    console.log('Dados temporários removidos. Redirecionando para login...');
                    
                    // Permitir navegação normal para /logout
                    // A requisição ao servidor irá:
                    // 1. Revogar autenticação no Supabase (se disponível)
                    // 2. Limpar session.clear() no Flask
                    // 3. Redirecionar para login
                });
            });
        });
    </script>
    
    <!-- Exibir mensagens flash do Flask como toasts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        // Mapear categorias do Flask para tipos de toast
                        const typeMap = {
                            'success': 'success',
                            'error': 'error',
                            'danger': 'error',
                            'warning': 'warning',
                            'info': 'info'
                        };
                        const toastType = typeMap[{{ category | tojson }}] || 'info';
                        
                        // Usar a função showToast do app.js
                        if (typeof showToast === 'function') {
                            showToast({{ message | tojson }}, toastType);
                        }
                    {% endfor %}
                {% endif %}
            {% endwith %}
        });
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
