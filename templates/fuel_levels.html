{% extends 'base.html' %}
{% block title %}Níveis de Combustível · Trivia Monitora{% endblock %}
{% block content %}
<section class="fuel-overview fuel-overview--minimal">


    {% if fuel_levels %}
        <div class="fuel-grid fuel-grid--minimal" data-fuel-grid>
            {% for equipamento in fuel_levels %}
                <article class="fuel-card fuel-card--{{ equipamento.nivel_status }}{% if equipamento.is_critical_focus %} fuel-card--low{% endif %}">
                    <div class="fuel-card__body fuel-card__body--compact">
                        <div class="fuel-card__gauge-wrapper">
                            <div class="semi-gauge" style="--fuel-level: {{ equipamento.nivel_percent or 0 }}; --fuel-color: {{ equipamento.level_color }};" role="img" aria-label="Nível {{ equipamento.nivel_display }} de {{ equipamento.nome }}">
                                <div class="semi-gauge__dial">
                                    <span>{{ equipamento.nivel_display }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="fuel-card__body-meta">
                            <h3>{{ equipamento.local }}</h3>
                            <p class="fuel-card__stat">Autonomia ≈ {{ equipamento.autonomia_display or '—' }}</p>
                            {% if equipamento.litros_disponiveis is not none %}
                            <p class="fuel-card__capacity">Cabem {{ equipamento.litros_disponiveis }} litros</p>
                            {% endif %}
                            <div class="fuel-card__status-row">
                                {% if not equipamento.status_online %}
                                <div class="fuel-card__status fuel-card__status--offline">
                                    <span class="fuel-card__status-dot"></span>offline
                                </div>
                                {% endif %}
                                {% if session.get('user') and equipamento.maps_url %}
                                <a href="{{ equipamento.maps_url }}" target="_blank" rel="noopener noreferrer" class="fuel-card__gps" title="Abrir no mapa">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-map-pin">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                </a>
                                {% endif %}
                            </div>
                            <!-- Updated delta badge is positioned absolutely in the card -->
                        </div>
                    </div>
                    {% set minutes = equipamento.ultima_diff_minutes %}
                    <div class="fuel-card__updated-badge {% if minutes is not none and minutes > 25 %}updated--white{% else %}updated--black{% endif %}">
                        {% if minutes is not none %}
                            Atualizado à {{ minutes|round(0)|int }} minutos
                        {% else %}
                            Atualizado à —
                        {% endif %}
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state card">
            <h3>Sem dados visíveis</h3>
            <p>Nenhum gerador com exibição habilitada foi encontrado.</p>
        </div>
    {% endif %}
</section>
{% endblock %}